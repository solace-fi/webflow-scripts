<script defer>const currentSort=[{direction:"asc",sorteable:"protocol"}];function makeActive(r){for(;r.hasClass("inactive");)r.removeClass("inactive")}function makeInactive(r){makeActive(r),r.addClass("inactive")}function isInCurrentSort(r,o,t){return r.some((r=>r.sorteable===o&&r.direction===t))}function removeFromCurrentSort(r,o){currentSort.forEach(((t,e)=>{t.sorteable===r&&t.direction===o&&currentSort.splice(e,1)}))}function addToCurrentSort(r,o){const t="asc"===o?"desc":"asc",e=currentSort.some((o=>o.sorteable===r&&o.direction===t));currentSort.forEach(((o,e)=>{o.sorteable===r&&o.direction===t&&currentSort.splice(e,1)})),currentSort.length>=2?(e?currentSort.pop():currentSort.shift(),currentSort.push({sorteable:r,direction:o})):currentSort.push({sorteable:r,direction:o})}const arrows={protocolUp:$(".protocol_sort .sort_up"),protocolDown:$(".protocol_sort .sort_down"),riskUp:$(".risk_sort .sort_up"),riskDown:$(".risk_sort .sort_down"),categoryUp:$(".category_sort .sort_up"),categoryDown:$(".category_sort .sort_down")};function makeAllActive(){Object.values(arrows).forEach(makeActive)}function makeAllInactive(){Object.values(arrows).forEach(makeInactive)}function makeActive(r){for(;r.hasClass("inactive");)r.removeClass("inactive")}function makeInactive(r){r.addClass("inactive")}const clientDirections=["up","down"],serverDirections=["asc","desc"],serverToClientDirection=r=>clientDirections[serverDirections.indexOf(r)],clientToServerDirection=r=>serverDirections[clientDirections.indexOf(r)],nestedArrows={protocol:{up:arrows.protocolUp,down:arrows.protocolDown},risk:{up:arrows.riskUp,down:arrows.riskDown},category:{up:arrows.categoryUp,down:arrows.categoryDown}};function updateArrows(){makeAllActive(),makeAllInactive(),console.log(JSON.stringify(currentSort,null,2)),currentSort.forEach(((r,o)=>{const{sorteable:t,direction:e}=r,n=serverToClientDirection(e),s=nestedArrows[t][n];makeActive(s)}))}function findSorteableFromArrow(r){const o=r.parent().parent();return["protocol","risk","category"].find((r=>o.hasClass(`${r}_sort`)))}function findDirectionFromArrow(r){return r.hasClass("sort_up")?"asc":r.hasClass("sort_down")?"desc":void 0}function toggleSort(r){const o=findSorteableFromArrow(r),t=findDirectionFromArrow(r);isInCurrentSort(currentSort,o,t)?removeFromCurrentSort(o,t):addToCurrentSort(o,t),updateArrows()}function capitalizeFirstLetter(r){return r.charAt(0).toUpperCase()+r.slice(1)}function processProtocolName(r){return r.split("-").map((r=>{switch(r.toLowerCase()){case"amm":case"apy":return r.toUpperCase();case"defi":return"DeFi";case"defisaver":return"DeFi Saver";case"deversifi":return"DeversiFi";case"derivadex":return"DerivaDEX";case"dao":return"DAO";case"liquiddriver":return"LiquidDriver";case"tokensets":return"TokenSets";case"wepiggy":return"WePiggy";case"waultswap":return"WaultSwap";case"stormswap":return"StormSwap";case"spiritswap":return"SpiritSwap";case"spookyswap":return"SpookySwap";case"snowswap":return"SnowSwap";case"shapeshift":return"ShapeShift";case"yieldyak":return"Yield Yak";default:return capitalizeFirstLetter(r)}})).join(" ")}const sortFunctions={protocol:{asc:(r,o)=>r.appId.localeCompare(o.appId),desc:(r,o)=>o.appId.localeCompare(r.appId)},category:{asc:(r,o)=>r.category.localeCompare(o.category),desc:(r,o)=>o.category.localeCompare(r.category)},risk:{asc:(r,o)=>r.tier-o.tier,desc:(r,o)=>o.tier-r.tier}};function sortProtocolList(r,o,t){console.log({protocols:r,sorteable:o,direction:t});return r.sort(sortFunctions[o][t])}function sortMappedProtocolList(r,o,t){console.log({protocols:r,sorteable:o,direction:t});return r.sort(sortFunctions[o][t])}function getSortedList(r){return 1===currentSort.length?sortProtocolList(r,currentSort[0].sorteable,currentSort[0].direction):sortProtocolList(sortProtocolList(r,currentSort[0].sorteable,currentSort[0].direction),currentSort[1].sorteable,currentSort[1].direction)}function getMappedSortedList(r){return 1===currentSort.length?sortMappedProtocolList(r,currentSort[0].sorteable,currentSort[0].direction):sortMappedProtocolList(sortMappedProtocolList(r,currentSort[0].sorteable,currentSort[0].direction),currentSort[1].sorteable,currentSort[1].direction)}function setClientProtocolsList(r){const o=document.querySelector(".protocol_list");r.forEach((r=>{const t=o.children[0].cloneNode(!0);t.querySelector(".protocol_logo").src="https://assets.solace.fi/zapperLogos/"+r.appId,t.querySelector(".protocol_name").innerHTML=processProtocolName(r.appId);const e=["F","A","B","C"][r.tier];t.querySelector(".protocol_risk").innerHTML=e,t.querySelector(".protocol_category").innerHTML=r.category,o.appendChild(t)})),o.removeChild(o.children[0])}function mapProtocolsToHtmlElements(r,o){const t=r.children();return o.map((r=>{const o=$(t).find(`:contains(${processProtocolName(r.appId)})`).parent().parent();return console.log(document.documentElement.innerHTML),{...r,element:o.length?o:void 0}}))}function reSortDOM(r){const o=$(".protocol_list");r.forEach(((r,t)=>{0===t&&console.log("first protocol",r);const e=$(r.element);o.append(e)}))}$(document).ready((async function(){const r=await fetch("https://risk-data.solace.fi/series");$(".loading_protocols").remove();const o=getSortedList((await r.json()).data.protocolMap);setClientProtocolsList(o);const t=mapProtocolsToHtmlElements($(".protocol_list"),o);$(".search_field").on("keyup",(function(){const r=$(this).val().toLowerCase();$(".protocol_list > div").each((function(){$(this).text().toLowerCase().indexOf(r)>-1?$(this).show():$(this).hide()}))})),updateArrows(),$(".sorting_header .sort_up").on("click",(function(){toggleSort($(this));reSortDOM(getMappedSortedList(t))})),$(".sorting_header .sort_down").on("click",(function(){toggleSort($(this)),reSortDOM(getMappedSortedList(t))}))}));</script>